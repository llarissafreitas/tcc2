<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastrar Vaga</title>
    <link rel="stylesheet" href="/css/vaga_card_styles.css">
    <style>
        form {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }
        label {
            min-width: 120px;
        }
        input, textarea, button {
            flex: 1 1 200px;
        }
    </style>
</head>
<body>
<main>
    <h1>Cadastro de Vaga</h1>
    <form id="form-vaga" autocomplete="on">
        <label for="titulo">Título:</label>
        <input type="text" id="titulo" name="titulo" required>

        <label for="descricao">Descrição:</label>
        <textarea id="descricao" name="descricao" required></textarea>

        <label for="local">Local:</label>
        <input type="text" id="local" name="local" required>

        <label for="salario">Salário:</label>
        <input type="number" id="salario" name="salario" step="0.01" required>

        <label for="empregadorId">ID do Empregador:</label>
        <input type="number" id="empregadorId" name="empregadorId" required>

        <button type="submit">Cadastrar Vaga</button>
    </form>
</main>

<script>
    document.getElementById("form-vaga").addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        const vagaDTO = {
            titulo: data.titulo,
            descricao: data.descricao,
            local: data.local,
            salario: parseFloat(data.salario),
            empregadorId: parseInt(data.empregadorId)
        };

        try {
            const response = await fetch("http://localhost:8081/vagas/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(vagaDTO),
                mode: "cors",
                credentials: "omit"
            });

            if (response.ok) {
                alert("Vaga cadastrada com sucesso!");
                this.reset();
            } else {
                const errorText = await response.text();
                alert("Erro ao cadastrar vaga:\n" + errorText);
            }
        } catch (err) {
            alert("Erro ao conectar com o servidor.");
            console.error(err);
        }
    });
</script>
</body>
</html>
